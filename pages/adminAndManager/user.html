<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>User Management</title>
  <link rel="stylesheet"
    href="https://maxst.icons8.com/vue-static/landings/line-awesome/line-awesome/1.3.0/css/line-awesome.min.css" />
  <link rel="stylesheet" href="../../style/adminAndManager/user.css" />
</head>

<body>
  <section>
    <!-- Header -->
    <header>
      <div>
        <img class="afteracadstext" src="../../assets/logo.png" alt="AfterAcads" />
      </div>
      <!-- Citation: navigation bar - (https://www.youtube.com/watch?v=oLgtucwjVII) -->
      <ul class="nav-links">
        <li><a href="home.html">Home</a></li>
        <li><a href="Registrants.html">Registrants</a></li>
        <li><a href="approvePost.html">Posts</a></li>
        <li><a href="eventsDashboard.html">Events</a></li>
        <li><a href="opportunities.html">Opportunities</a></li>

        <!-- Dropdown for Statistics -->
        <li class="dropdown">
          <a href="javascript:void(0)">Statistics</a>
          <div class="dropdown-content">
            <a href="#">Users</a>
            <a href="#">Posts</a>
            <a href="#">Events</a>
            <a href="#">Opportunities</a>
          </div>
        </li>

        <li><a href="user.html">Users</a></li>
      </ul>
      <div class="profile">
        <li>
          <a href="managerProfile.html">
            <img class="profile-img" src="../../assets/profileIcon.jpg" alt="Profile" />
          </a>
        </li>
      </div>
    </header>

    <!-- User Section -->

    <!-- Citation: user section container design and table for users with it's button - (https://www.youtube.com/watch?v=gUf1fpJwvmA&list=PLR5xnAxI5K55BhYLWb7CqiL7KGSIEOlxO&index=6) -->
    <div class="users-section container">
      <div class="search-and-buttons">
        <input type="text" class="search-input" placeholder="Search..." />
        <button class="btn AddUSer" id="addUserBtn">Add User</button>
      </div>
      <p>Total Users: <span id="totalUsers">16</span></p>
    </div>

    <div class="container1">
      <!-- Table for Users -->
      <table class="user-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>First Name</th>
            <th>
              Last Name
              <button class="sort-button" data-sort="asc" onclick="toggleSort(this, 3)">
                <span class="arrow-up">&#9650;</span>
                <span class="arrow-down">&#9660;</span>
              </button>
            </th>
            <th>Email</th>
            <th>User Role</th>
            <th>Date Created</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <!-- User Data -->
        </tbody>
      </table>
    </div>
    <!-- Pagination -->
    <div class="pagination">
      <button class="btn pagination-btn" id="prevBtn" disabled>
        Previous
      </button>
      <span id="pageNumber">Page 1</span>
      <button class="btn pagination-btn" id="nextBtn">Next</button>
    </div>

    <!-- User Details Modal -->
    <div class="user-details-modal" id="userDetailsModal">
      <div class="modal-content">
        <span class="close-btn" id="closeModal">&times;</span>
        <h2>User Details</h2>
        <hr class="modal-divider" />
        <p><strong>First Name:</strong> <span id="firstName"></span></p>
        <p><strong>Middle Name:</strong> <span id="middleName"></span></p>
        <p><strong>Last Name:</strong> <span id="lastName"></span></p>
        <p><strong>Gender:</strong> <span id="gender"></span></p>
        <p><strong>Email:</strong> <span id="email"></span></p>
      </div>
    </div>
  </section>

  <!-- JavaScript for Sorting -->
  <!-- Citation: This JavaScript code was debugged with assistance from ChatGPT.  -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const sortTable = (columnIndex, isAscending) => {
        const tbody = document.querySelector("tbody");
        const rows = Array.from(tbody.rows);

        rows.sort((a, b) => {
          const cellA = a.cells[columnIndex].textContent.trim();
          const cellB = b.cells[columnIndex].textContent.trim();

          if (!isNaN(Date.parse(cellA)) && !isNaN(Date.parse(cellB))) {
            return isAscending
              ? new Date(cellA) - new Date(cellB)
              : new Date(cellB) - new Date(cellA);
          }
          if (!isNaN(cellA) && !isNaN(cellB)) {
            return isAscending ? cellA - cellB : cellB - cellA;
          }

          return isAscending
            ? cellA.localeCompare(cellB)
            : cellB.localeCompare(cellA);
        });

        rows.forEach((row) => tbody.appendChild(row));
      };

      const toggleSort = (button, columnIndex) => {
        const isAscending = button.dataset.sort === "asc";
        button.dataset.sort = isAscending ? "desc" : "asc";
        sortTable(columnIndex, !isAscending);
      };

      document.querySelectorAll(".sort-button").forEach((button, index) => {
        button.addEventListener("click", () => toggleSort(button, index));
      });
    });
  </script>

  <!-- JavaScript for Search Input -->

  <!-- Citation: Search Bar In JavaScript (https://www.youtube.com/watch?v=TlP5WIxVirU&t=600s) -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const searchInput = document.querySelector(".search-input");
      const rows = document.querySelectorAll(".user-table tbody tr");

      searchInput.addEventListener("input", (event) => {
        const searchValue = event.target.value.toLowerCase();
        rows.forEach((row) => {
          const cells = Array.from(row.querySelectorAll("td"));
          const rowText = cells
            .map((cell) => cell.textContent.toLowerCase())
            .join(" ");
          row.style.display = rowText.includes(searchValue) ? "" : "none";
        });
      });
    });
  </script>

  <!-- JavaScript for Pagination -->
  <!-- Citation: JavaScript Pagination (https://www.youtube.com/watch?v=Ynp6Gdd3XVE) -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const rowsPerPage = 10;
      const rows = document.querySelectorAll(".user-table tbody tr");
      const totalPages = Math.ceil(rows.length / rowsPerPage);
      let currentPage = 1;

      const showPage = (page) => {
        const startIdx = (page - 1) * rowsPerPage;
        const endIdx = page * rowsPerPage;

        rows.forEach((row, index) => {
          row.style.display =
            index >= startIdx && index < endIdx ? "" : "none";
        });

        document.getElementById("pageNumber").textContent = `Page ${page}`;
        document.getElementById("prevBtn").disabled = page === 1;
        document.getElementById("nextBtn").disabled = page === totalPages;
      };

      document.getElementById("nextBtn").addEventListener("click", () => {
        if (currentPage < totalPages) {
          currentPage++;
          showPage(currentPage);
        }
      });

      document.getElementById("prevBtn").addEventListener("click", () => {
        if (currentPage > 1) {
          currentPage--;
          showPage(currentPage);
        }
      });

      showPage(currentPage);
    });
  </script>

  <!-- JavaScript for Adding a User -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const addUserBtn = document.getElementById("addUserBtn");
      const totalUsersDisplay = document.getElementById("totalUsers");
      const userTableBody = document.querySelector(".user-table tbody");
      let userId = 17; // Starting user ID

      const updateTotalUsers = () => {
        totalUsersDisplay.textContent = userTableBody.rows.length;
      };

      addUserBtn.addEventListener("click", () => {
        // Open modal to add user (modal code not shown here)
      });

      // Add new user row code goes here (similar to the existing form logic)
      // After user added, update total users count
    });
  </script>

  <!-- JavaScript for Populating Users Table -->
  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const userTableBody = document.querySelector(".user-table tbody");

    // Fetch and populate the users table
    const populateUsersTable = () => {
      fetch("/api/users/getApprovedUsers/?status=approved")
        .then((response) => {
          if (!response.ok) throw new Error("Failed to fetch users");
          return response.json();
        })
        .then((data) => {
          userTableBody.innerHTML = ""; // Clear the table body
          data.forEach((user) => {
            const row = document.createElement("tr");
            row.innerHTML = `
              <td>${user.id}</td>
              <td>${user.first_name}</td>
              <td>${user.last_name}</td>
              <td>${user.email}</td>
              <td>${user.role}</td>
              <td>${new Date(user.date_created).toLocaleDateString()}</td>
              <td>
                <button class="editBtn" data-id="${user.id}">Edit</button>
                <button class="restrictBtn" data-id="${user.id}">Restrict</button>
              </td>
            `;
            userTableBody.appendChild(row);
          });
        })
        .catch((error) => console.error("Error fetching users:", error));
    };

    // Load users table on page load
    populateUsersTable();
  
  });
  </script>
</body>

</html>