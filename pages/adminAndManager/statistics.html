<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Statistics</title>
    <link rel="stylesheet"
        href="https://maxst.icons8.com/vue-static/landings/line-awesome/line-awesome/1.3.0/css/line-awesome.min.css" />
    <link rel="stylesheet" href="../../style/adminAndManager/statistics.css" />
    <script src="script.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
     <section>
        <header>
                <div>
                    <img class="afteracadstext" src="../../assets/logo.png" alt="afteracads" />
                </div>
                <!-- Citation: navigation bar - (https://www.youtube.com/watch?v=oLgtucwjVII) -->
                <ul class="nav-links">
                    <li><a href="home.html">Home</a></li>
                    <li><a href="Registrants.html">Registrants</a></li>
                    <li><a href="approvePost.html">Posts</a></li>
                    <li><a href="eventsDashboard.html">Events</a></li>
                    <li><a href="opportunities.html">Opportunities</a></li>
                        
                    <!-- Dropdown for Statistics -->
                    <li class="dropdown">
                        <a href="javascript:void(0)">Statistics</a>
                        <div class="dropdown-content">
                        <a href="#">Users</a>
                        <a href="#">Posts</a>
                        <a href="#">Events</a>
                        <a href="#">Opportunities</a>
                        </div>
                    </li>
                    <li><a href="user.html">Users</a></li>
                </ul>
                <div class="profile">
                    <li><a href="managerProfile.html"><img class="profile-img" src="../../assets/display-photo.png"
                                alt="Profile" /></a></li>
                </div>
                </div>
                </div>
            </header>
    </section>
        <div class="events-section container">
            <div class="search-and-buttons">
                <div class="button-group">
                    </select>
                    <div class="button-group">
                        <button class="btn-Users" data-target="users-container">Users</button>
                        <button class="btn-Opportunities" data-target="opportunities-container">Opportunities</button>
                        <button class="btn-Posts" data-target="posts-container">Posts</button>
                        <button class="btn-Events" data-target="events-container">Events</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Citation: Design for the statistics - (https://www.youtube.com/watch?v=CgCPP2KO5ds) -->

        <!-- Containers for each type of statistics -->
        <div id="users-container" class="stats-container">
            <h2>Users Statistics</h2>
            <div class="cards">
                <div class="card-single">
                    <!-- Total Users -->
                    <p id="total-users">Loading total users...</p>

                    <!-- Status Breakdown -->
                    <h3>Status Breakdown</h3>
                        <ul id="status-breakdown">
                            <!-- Status-specific counts will be dynamically inserted here -->
                        </ul>
                </div>
                <div class="card-single">
                    <!-- Employment Status Chart -->
                    <div>
                        <h3>Employment Status</h3>
                        <canvas id="employmentStatusChart"></canvas>
                    </div>
                </div>
                <div class="card-single">
                    <!-- Gender Distribution Chart -->
                    <div>
                        <h3>Gender Distribution</h3>
                        <canvas id="genderChart"></canvas>
                    </div>   
                </div>
                <div class="card-single">
                    <!-- Batch Group Chart -->
                    <div>
                        <h3>Users Grouped by Batch</h3>
                        <canvas id="batchGroupChart"></canvas>
                    </div>
                </div>
                <div class="card-single">
                    <!-- Course Group Chart -->
                    <div>
                        <h3>Users Grouped by Course</h3>
                        <canvas id="courseGroupChart"></canvas>
                    </div>
                </div>
                <div class="card-single">
                    <!-- School Group Chart -->
                    <div>
                        <h3>Users Grouped by School</h3>
                        <canvas id="schoolGroupChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div id="opportunities-container" class="stats-container" style="display: none;">
            <h2>Opportunities Statistics</h2>
            <div class="cards">
                <div class="card-single">

                </div>
            </div>
        </div>

        <div id="posts-container" class="stats-container" style="display: none;">
            <h2>Posts Statistics</h2>
            <div class="cards">
                <div class="card-single">Posts-specific stats...</div>
            </div>
        </div>

        <div id="events-container" class="stats-container" style="display: none;">
            <h2>Events Statistics</h2>
            <div class="cards">
                <div class="card-single">Events-specific stats...</div>
            </div>
        </div>

        </main>
        <!-- Citation:  ChatGPT assisted in debugging the sidebar toggle functionality and layout adjustment logic.  -->
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const sidebar = document.querySelector(".sidebar");
                const toggleButton = document.getElementById("sidebarToggle");

                toggleButton.addEventListener("click", function () {
                    sidebar.classList.toggle("minimized");

                    // Add this to adjust the main content dynamically
                    const mainContent = document.querySelector(".main-content");
                    if (sidebar.classList.contains("minimized")) {
                        mainContent.style.marginLeft = "60px"; // Adjust for minimized sidebar
                    } else {
                        mainContent.style.marginLeft = "280px"; // Restore when sidebar is full
                    }
                });
            });
        </script>

        <!-- Scripts for Toggling Between Containers -->
        <script>
        document.addEventListener("DOMContentLoaded", function () {
            const buttons = document.querySelectorAll(".button-group button");
            const containers = document.querySelectorAll(".stats-container"); 

            buttons.forEach((button) => {
                button.addEventListener("click", function () {
                
                    const target = button.getAttribute("data-target");

                    // Hide all containers
                    containers.forEach((container) => {
                        container.classList.remove("active");
                        container.style.display = "none"; 
                    });

                    // Show the selected container
                    const targetContainer = document.getElementById(target);
                    if (targetContainer) {
                        targetContainer.classList.add("active");
                        targetContainer.style.display = "block"; 
                    }
                });
            });
        });
        </script>

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                async function fetchUserStatistics() {
                    try {
                        // Fetch total users and status breakdown
                        const userStatsResponse = await fetch('/api/users/usercount');
                        const userStatsData = await userStatsResponse.json();

                        // Display total users
                        document.getElementById('total-users').textContent = `Total Users: ${userStatsData.totalUsers}`;

                        // Display status breakdown
                        const statusList = document.getElementById('status-breakdown');
                        statusList.innerHTML = ''; // Clear existing list
                        userStatsData.statusCounts.forEach(status => {
                            const listItem = document.createElement('li');
                            listItem.textContent = `${status.status}: ${status.total}`;
                            statusList.appendChild(listItem);
                        });

                        // Fetch employment status data
                        const employmentResponse = await fetch('/api/users/employment-status');
                        const employmentData = await employmentResponse.json();
                        const employmentLabels = employmentData.map(item => item.employment_status);
                        const employmentCounts = employmentData.map(item => item.total);

                        // Render Employment Status Chart
                        const employmentCtx = document.getElementById('employmentStatusChart').getContext('2d');
                        new Chart(employmentCtx, {
                            type: 'pie',
                            data: {
                                labels: employmentLabels,
                                datasets: [{
                                    label: 'Employment Status',
                                    data: employmentCounts,
                                    backgroundColor: ['#36A2EB', '#FF6384', '#FFCE56'], // Adjust colors as needed
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                responsive: true,
                                plugins: {
                                    legend: {
                                        position: 'top'
                                    }
                                }
                            }
                        });

                        // Fetch gender distribution data
                        const genderResponse = await fetch('/api/users/gendergroup');
                        const genderData = await genderResponse.json();
                        const genderLabels = genderData.map(item => item.gender);
                        const genderCounts = genderData.map(item => item.total);

                        // Render Gender Distribution Chart
                        const genderCtx = document.getElementById('genderChart').getContext('2d');
                        new Chart(genderCtx, {
                            type: 'bar',
                            data: {
                                labels: genderLabels,
                                datasets: [{
                                    label: 'Gender Distribution',
                                    data: genderCounts,
                                    backgroundColor: ['#4BC0C0', '#FF9F40', '#9966FF'], // Adjust colors as needed
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                responsive: true,
                                plugins: {
                                    legend: {
                                        position: 'top'
                                    }
                                }
                            }
                        });

                        // Fetch users grouped by batch
                        const batchResponse = await fetch('/api/users/batchesgroup');
                        const batchData = await batchResponse.json();
                        const batchLabels = batchData.map(item => `Batch ${item.batch_number}`);
                        const batchCounts = batchData.map(item => item.total);

                        // Render Batch Group Chart
                        const batchCtx = document.getElementById('batchGroupChart').getContext('2d');
                        new Chart(batchCtx, {
                            type: 'bar',
                            data: {
                                labels: batchLabels,
                                datasets: [{
                                    label: 'Users by Batch',
                                    data: batchCounts,
                                    backgroundColor: '#FF6384',
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                responsive: true,
                                plugins: {
                                    legend: {
                                        position: 'top'
                                    }
                                }
                            }
                        });

                        // Fetch users grouped by course
                        const courseResponse = await fetch('/api/users/coursesgroup');
                        const courseData = await courseResponse.json();
                        const courseLabels = courseData.map(item => item.course_name);
                        const courseCounts = courseData.map(item => item.total);

                        // Render Course Group Chart
                        const courseCtx = document.getElementById('courseGroupChart').getContext('2d');
                        new Chart(courseCtx, {
                            type: 'bar',
                            data: {
                                labels: courseLabels,
                                datasets: [{
                                    label: 'Users by Course',
                                    data: courseCounts,
                                    backgroundColor: '#FFCE56',
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                responsive: true,
                                plugins: {
                                    legend: {
                                        position: 'top'
                                    }
                                }
                            }
                        });

                        // Fetch users grouped by school
                        const schoolResponse = await fetch('/api/users/schoolsgroup');
                        const schoolData = await schoolResponse.json();
                        const schoolLabels = schoolData.map(item => item.school_name);
                        const schoolCounts = schoolData.map(item => item.total);

                        // Render School Group Chart
                        const schoolCtx = document.getElementById('schoolGroupChart').getContext('2d');
                        new Chart(schoolCtx, {
                            type: 'bar',
                            data: {
                                labels: schoolLabels,
                                datasets: [{
                                    label: 'Users by School',
                                    data: schoolCounts,
                                    backgroundColor: '#36A2EB',
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                responsive: true,
                                plugins: {
                                    legend: {
                                        position: 'top'
                                    }
                                }
                            }
                        });

                    } catch (error) {
                        console.error('Error fetching user statistics:', error);
                    }
                }

                // Call the function to load statistics
                fetchUserStatistics();
            });
            
        </script>
</body>

</html>