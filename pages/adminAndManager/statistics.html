<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Statistics</title>
    <link rel="stylesheet"
        href="https://maxst.icons8.com/vue-static/landings/line-awesome/line-awesome/1.3.0/css/line-awesome.min.css" />
    <link rel="stylesheet" href="../../style/adminAndManager/statistics.css" />
    <script src="script.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
     <section>
        <header>
                <div>
                    <img class="afteracadstext" src="../../assets/logo.png" alt="afteracads" />
                </div>
                <!-- Citation: navigation bar - (https://www.youtube.com/watch?v=oLgtucwjVII) -->
                <ul class="nav-links">
                    <li><a href="home.html">Home</a></li>
                    <li><a href="Registrants.html">Registrants</a></li>
                    <li><a href="approvePost.html">Posts</a></li>
                    <li><a href="eventsDashboard.html">Events</a></li>
                    <li><a href="opportunities.html">Opportunities</a></li>
                        
                    <!-- Dropdown for Statistics -->
                    <li class="dropdown">
                        <a href="javascript:void(0)">Statistics</a>
                        <div class="dropdown-content">
                        <a href="#">Users</a>
                        <a href="#">Posts</a>
                        <a href="#">Events</a>
                        <a href="#">Opportunities</a>
                        </div>
                    </li>
                    <li><a href="user.html">Users</a></li>
                </ul>
                <div class="profile">
                    <li><a href="managerProfile.html"><img class="profile-img" src="../../assets/display-photo.png"
                                alt="Profile" /></a></li>
                </div>
                </div>
                </div>
            </header>
    </section>
        <div class="events-section container">
            <div class="search-and-buttons">
                <div class="button-group">
                    </select>
                    <div class="button-group">
                        <button class="btn-Users" data-target="users-container">Users</button>
                        <button class="btn-Opportunities" data-target="opportunities-container">Opportunities</button>
                        <button class="btn-Posts" data-target="posts-container">Posts</button>
                        <button class="btn-Events" data-target="events-container">Events</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Citation: Design for the statistics - (https://www.youtube.com/watch?v=CgCPP2KO5ds) -->

        <!-- Containers for each type of statistics -->
        <div id="users-container" class="stats-container">
            <h2>Users Statistics</h2>
            <div class="cards">
                <div class="card-single">
                    <!-- Total Approved Users -->
                    <div>
                        <h3>Total Approved Users</h3>
                        <p id="total-approved-users">Loading...</p>
                    </div>
                </div>
                <div class="card-single">
                    <!-- Employment Status Chart -->
                    <div>
                        <h3>Employment Status</h3>
                        <canvas id="employmentStatusChart"></canvas>
                    </div>
                </div>
                <div class="card-single">
                    <!-- Gender Distribution Chart -->
                    <div>
                        <h3>Gender Distribution</h3>
                        <canvas id="genderChart"></canvas>
                    </div>   
                </div>
                <div class="card-single">

                </div>
                <div class="card-single">

                </div>
            </div>
        </div>

        <div id="opportunities-container" class="stats-container" style="display: none;">
            <h2>Opportunities Statistics</h2>
            <div class="cards">
                <div class="card-single">
                    
                </div>
            </div>
        </div>

        <div id="posts-container" class="stats-container" style="display: none;">
            <h2>Posts Statistics</h2>
            <div class="cards">
                <div class="card-single">Posts-specific stats...</div>
            </div>
        </div>

        <div id="events-container" class="stats-container" style="display: none;">
            <h2>Events Statistics</h2>
            <div class="cards">
                <div class="card-single">Events-specific stats...</div>
            </div>
        </div>

        </main>
        <!-- Citation:  ChatGPT assisted in debugging the sidebar toggle functionality and layout adjustment logic.  -->
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const sidebar = document.querySelector(".sidebar");
                const toggleButton = document.getElementById("sidebarToggle");

                toggleButton.addEventListener("click", function () {
                    sidebar.classList.toggle("minimized");

                    // Add this to adjust the main content dynamically
                    const mainContent = document.querySelector(".main-content");
                    if (sidebar.classList.contains("minimized")) {
                        mainContent.style.marginLeft = "60px"; // Adjust for minimized sidebar
                    } else {
                        mainContent.style.marginLeft = "280px"; // Restore when sidebar is full
                    }
                });
            });
        </script>

        <!-- Scripts for Toggling Between Containers -->
        <script>
        document.addEventListener("DOMContentLoaded", function () {
            const buttons = document.querySelectorAll(".button-group button");
            const containers = document.querySelectorAll(".stats-container"); 

            buttons.forEach((button) => {
                button.addEventListener("click", function () {
                
                    const target = button.getAttribute("data-target");

                    // Hide all containers
                    containers.forEach((container) => {
                        container.classList.remove("active");
                        container.style.display = "none"; 
                    });

                    // Show the selected container
                    const targetContainer = document.getElementById(target);
                    if (targetContainer) {
                        targetContainer.classList.add("active");
                        targetContainer.style.display = "block"; 
                    }
                });
            });
        });
        </script>


        <script>
            document.addEventListener("DOMContentLoaded", function () {
                async function fetchUserStatistics() {
                    try {
                        // Fetch total approved users
                        const approvedResponse = await fetch('/api/users/approved');
                        const approvedData = await approvedResponse.json();
                        document.getElementById('total-approved-users').textContent = `Total: ${approvedData.totalApprovedUsers}`;

                        // Fetch employment status data
                        const employmentResponse = await fetch('/api/users/employment-status');
                        const employmentData = await employmentResponse.json();
                        const employmentLabels = employmentData.map(item => item.employment_status);
                        const employmentCounts = employmentData.map(item => item.total);

                        // Render Employment Status Chart
                        const employmentCtx = document.getElementById('employmentStatusChart').getContext('2d');
                        new Chart(employmentCtx, {
                            type: 'pie',
                            data: {
                                labels: employmentLabels,
                                datasets: [{
                                    label: 'Employment Status',
                                    data: employmentCounts,
                                    backgroundColor: ['#36A2EB', '#FF6384', '#FFCE56'], // Adjust colors as needed
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                responsive: true,
                                plugins: {
                                    legend: {
                                        position: 'top'
                                    }
                                }
                            }
                        });

                        // Fetch gender distribution data
                        const genderResponse = await fetch('/api/users/gendergroup');
                        const genderData = await genderResponse.json();
                        const genderLabels = genderData.map(item => item.gender);
                        const genderCounts = genderData.map(item => item.total);

                        // Render Gender Distribution Chart
                        const genderCtx = document.getElementById('genderChart').getContext('2d');
                        new Chart(genderCtx, {
                            type: 'bar',
                            data: {
                                labels: genderLabels,
                                datasets: [{
                                    label: 'Gender Distribution',
                                    data: genderCounts,
                                    backgroundColor: ['#4BC0C0', '#FF9F40', '#9966FF'], // Adjust colors as needed
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                responsive: true,
                                plugins: {
                                    legend: {
                                        position: 'top'
                                    }
                                }
                            }
                        });
                    } catch (error) {
                        console.error('Error fetching user statistics:', error);
                    }
                }

                // Call the function to load statistics
                fetchUserStatistics();
            });
            
        </script>
</body>

</html>